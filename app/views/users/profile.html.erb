<%= content_for(:meta_title, "#{t('nlt.user_profile')} - #{@user.username}") %>

<div id="default_header_section">
  <h1><%= t('nlt.user_profile') %> - <%= @user.username %></h1>
</div>

<div class="col-md-9 col-sm-9">
  <div class="row">
    <%= render partial: "users/tabnav", locals: {user: @user} %>
    <div class="ad_excerpt">
      <h4><%= t('nlt.username') %>: <%= @user.username %></h4>
      <h4><%= t('nlt.member_since') %>: <%= l @user.created_at, format: :long %></h4>
      <ul>

        <% if user_signed_in? %>
          <% if current_user == @user %>
            <li>
              <%= link_to t('nlt.user_edit_profile'), user_edit_path(@user) %>
            </li>
          <% else %>
            <% blocking = current_user.blocking?(@user) %>

            <% if blocking %>
              <li>
                <%= link_to blocking,
                            method: :delete,
                            class: 'world_link' do %>
                  <%= t('nlt.profile_actions.blocking.delete', username: @user.username) %>

                  <%= image_tag "unblock.png" %>
                <% end %>
              </li>
            <% else %>
              <li>
                <%= link_to blockings_path(blocked_id: @user.id),
                            data: { confirm: t('nlt.profile_actions.blocking.confirm', username: @user.username) },
                            method: :post,
                            class: 'world_link' do %>
                  <%= t('nlt.profile_actions.blocking.add', username: @user.username) %>

                  <%= image_tag "block.png" %>
                <% end %>
              </li>

              <li>
                <%= link_to new_conversation_path(recipient_id: @user.id),
                            class: "world_link" do %>
                  <%= t('nlt.send_a_message_to') %> <%= @user.username %>
                  <%= image_tag "email_send.png" %>
                <% end %>
              </li>

              <li>
                <% friendship = current_user.friend?(@user) %>

                <% if friendship.nil? %>
                  <%= link_to friendships_path(friend_id: @user.id),
                              class: 'world_link',
                              method: :post do %>
                    <%= t('nlt.profile_actions.friend.add', username: @user.username) %>

                    <%= image_tag "friend_add.png" %>
                  <% end %>
                <% else %>
                  <%= link_to friendship, class: 'world_link', method: :delete do %>
                    <%= t('nlt.profile_actions.friend.delete', username: @user.username) %>

                    <%= image_tag "friend_delete.png" %>
                  <% end %>
                <% end %>
              </li>
            <% end %>
          <% end %>
        <% end %>

        <% if policy(:admin).lock? %>
          <li>
            <% if @user.locked? %>
              <%= link_to unlock_user_path(@user.id),
                          data: {confirm: "¿Estás seguro que quieres desbloquear a este usuario? Podrá volver iniciar sesión."},
                          class: 'world_link' do %>
                <%= t('nlt.admin.unlock_user') %>
                <%= image_tag "add.png" %>
              <% end %>
            <% else %>
              <%= link_to lock_user_path(@user.id),
                          data: {confirm: "¿Estás seguro que quieres bloquear a este usuario? No podrá iniciar sesión."},
                          class: 'world_link' do %>
                <%= t('nlt.admin.lock_user') %>
                <%= image_tag "remove.png" %>
              <% end %>
            <% end %>
          </li>
        <% end %>

        <% if policy(:admin).become? %>
          <li>
            <%= link_to t('nlt.admin.become_user'),
                        become_user_path(@user.id),
                        class: 'world_link' %>
          </li>
        <% end %>
      </ul>

      <% unless @user.friends.count == 0 %>
        <div>
        <h4><%= t('nlt.friends') %>:</h4>
        <ul>
          <% @user.friends.each do |friend| %>
            <li>
              <%= link_to friend.username, profile_path(friend.username) %>
            </li>
          <% end %>
        </ul>
        <br>
        </div>
      <% end %>
    </div>
  </div>
</div>
